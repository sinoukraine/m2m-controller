<!--suppress JSAnnotator -->
<template>
	<div data-name="edit-command" class="page"> <!-- page-with-subnavbar -->
		<!-- Top Navbar -->
		<div class="navbar">
            <div class="navbar-bg"></div>
            <div class="navbar-inner">
                <div class="left">
                    <a href="#" class="back link icon-only " >
                        <i class="icon material-icons">arrow_back</i>
                    </a>
                </div>
                <div class="title sliding">
                    {{name}}
                </div>
            </div>
        </div>
		
		<div class="page-content">			
			
			<div class="block-title">You can edit your command here</div>
			<div class="list inset">
				<input type="hidden" name="imsi" value="{{imsi}}">
				<input type="hidden" name="login" value="{{login}}">
			  <ul>
				<li class="item-content item-input">
				  <div class="item-inner">
					<div class="item-input-wrap">
					  <input type="text" name="name" value="{{name}}" placeholder="Name">
					  <span class="input-clear-button"></span>
					</div>
				  </div>
				</li>
				<li class="item-content item-input">
				  <div class="item-inner">
					<div class="item-input-wrap">
					  <input type="text" name="content" value="{{content}}" placeholder="Command">
					  <span class="input-clear-button"></span>
					</div>
				  </div>
				</li>
				<li class="item-content item-input">
				  <div class="item-inner">
					<div class="item-input-wrap">
					  <input type="text" name="description" value="{{description}}" placeholder="Description">
					  <span class="input-clear-button"></span>
					</div>
				  </div>
				</li>
				<li class="item-content item-input">
				  <div class="item-inner">
					<div class="item-input-wrap">
					  <input type="text" name="path" value="{{path}}" placeholder="Group Name">
					  <span class="input-clear-button"></span>
					</div>
				  </div>
				</li>
			  </ul>
			</div>
			
			<div class="location-div">
				<button class="col button button-outline saveData" >Save</button>
			</div>
		</div>
	</div>
</template>

<script>
  // script must return component object
    return { 
        data: function () {
            var self = this;
            var ret = {
				name: '',
				content: '',
				description: '',
				path: '',
				login: '',
				imsi: ''
			};   
			
            if (self.$route.query.id) {
				ret.id = self.$route.query.id;
            }

            return ret;
        },					
        methods: {
			saveData: function () {
                let self = this;
					self.$app.preloader.show();
					
					var data = {
						content: $$("input[name='content']").val(),
						description: $$("input[name='description']").val(),
						imsi: $$("input[name='imsi']").val(),
						login: $$("input[name='login']").val(),
						name: $$("input[name='name']").val(),
						path: $$("input[name='path']").val(),
					}
					
					$.ajax({
						async: true,
						crossDomain: true,
						url: "http://m2mdata03.sinopacific.com.ua/em/v3/sms/" + self.id,
						method: "PUT",
						headers: {
							"authorization": "12345",
							"content-type": "application/json"
						},
						processData: false,
						data: JSON.stringify(data),
						success: function (result) {							
							self.$app.preloader.hide();
						},
						error: function(XMLHttpRequest, textStatus, errorThrown){
							console.log('can not connect: txt = '+textStatus+' err = '+errorThrown);
						}
					});	
			},
			getData: function () {
                let self = this;
					self.$app.preloader.show();
					$.ajax({
						type: "GET",		        
						url: 'http://m2mdata03.sinopacific.com.ua/em/v3/sms/' + self.id,
						dataType: "json",	
						async: true,
						cache: false,
						headers: { 
							Authorization: "12345"
						},
						success: function (result) {console.log(result);
							if (result) {								
								self.setData(result);
							}	
							self.$app.preloader.hide();
						},
						error: function(XMLHttpRequest, textStatus, errorThrown){
							console.log('can not connect: txt = '+textStatus+' err = '+errorThrown);
							self.$app.preloader.hide();							
						}
					});				
			},
			setData: function (data) {
                let self = this;
						
				self.$setState({
					content: data.content,
					description: data.description,
					name: data.name,
					path: data.path,
					imsi: data.imsi,
					login: data.login
				});
									
				// Append new items
				//$$('.commandsList ul').append(html);		
			},	
		},
        on: {
            pageInit: function (e, page) {
                let self = this;
				
				self.getData();
				$('.saveData').on('click', function(){		
					self.saveData();							
				});
			}
		}
    };
</script>
    