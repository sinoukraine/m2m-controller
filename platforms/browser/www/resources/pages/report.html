<!--suppress JSAnnotator -->
<template>
	<div data-name="report" class="page report-page"> <!-- page-with-subnavbar -->
		<!-- Top Navbar -->
		<div class="navbar">
            <div class="navbar-bg"></div>
            <div class="navbar-inner">
                <div class="left">
                    <a href="#" class="back link icon-only " >
                        <i class="icon material-icons">arrow_back</i>
                    </a>
                </div>
                <div class="title sliding">
                    Data Usage
                </div>
            </div>
        </div>
		
		<div class="page-content ">
			<!--<div class="block searchbar-hide-on-search">
				<h3>{{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG02}}</h3>
                <p>{{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG03}}</p>				
            </div>
			<div class="imsi-usage-table data-table">
			  <table>
				<thead>
				  <tr>
					<th class="label-cell">IMSI</th>
					<th class="numeric-cell">Data Usage(MB)</th>
					<th class="numeric-cell">Flow Usage</th>
					<th class="numeric-cell">SMS Usage</th>
					<th class="numeric-cell">Days</th>
				  </tr>
				</thead>
				<tbody>
				{{#each IMSIUsageArray}}                        
				  <tr>
					<td class="label-cell">{{IMSI}}</td>
					<td class="numeric-cell">{{IMSI}}</td>
					<td class="numeric-cell">{{IMSI}}</td>
					<td class="numeric-cell">{{IMSI}}</td>
					<td class="numeric-cell">{{IMSI}}</td>
				  </tr>				  
                {{/each}}
				</tbody>
			  </table>
			  <div class="data-table-footer">
				<div class="data-table-rows-select">
				  Per page:
				  <div class="input input-dropdown">
					<select>
					  <option value="5">5</option>
					  <option value="10">10</option>
					  <option value="25">25</option>
					  <option value="all">All</option>
					</select>
				  </div>
				</div>
				<div class="data-table-pagination">
				  <span class="data-table-pagination-label">1-5 of 10</span>
				  <a href="#" class="link disabled">
					<i class="icon icon-prev color-gray"></i>
				  </a>
				  <a href="#" class="link">
					<i class="icon icon-next color-gray"></i>
				  </a>
				</div>
			  </div>
			</div>-->
			
			<!--<div class="list">
				<input type="hidden" name="IMSI" value="{{IMSI}}">
				<input type="hidden" name="LastDay" value="1">
			  <ul>
            
                <li class="item-content border_bottom">
                    <div class="item-inner display-block">
                        <div class="item-title label">{{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG06}}</div>
                        <div class="item-input">
                            <select name="LastDaySelect" data-set="{{LastDay}}">                 
								<option value="1">1 day</option>
								<option value="2">3 days</option>
								<option value="7">1 week</option>
								<option value="14">2 weeks</option>
								<option value="30">1 month</option>
								<option value="60">2 months</option>
								<option value="3000">all time</option>
                                <option value="1">1 {{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG04}}</option>
                                <option value="2">2 {{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG05}}</option>
                                <option value="3">3 {{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG05}}</option>
                                <option value="4">4 {{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG05}}</option>
                                <option value="5">5 {{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG05}}</option> 
                                <option value="6">6 {{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG05}}</option>                                
                                <option value="7">7 {{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG05}}</option> 
                                <option value="8">8 {{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG05}}</option> 
                                <option value="9">9 {{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG05}}</option> 
                                <option value="10">10 {{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG05}}</option> 
                                <option value="11">11 {{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG05}}</option> 
                                <option value="12">12 {{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG05}}</option> 
                                <option value="13">13 {{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG05}}</option> 
                                <option value="14">14 {{@global.LANGUAGE.ASSET_COMMANDS_HISTORY_MSG05}}</option>
                            </select>
                            <i class="f7-icons icon-arrow-drop-down select_arrow"></i>
                        </div>
                    </div>
                </li>
            </ul>
        </div>-->
		
		<div key="KeyCOverview" class="col-50 tablet-20  ">
				<div class="card dashboard-card-type1 elevation-6 elevation-hover-9 elevation-transition overflow-scroll-hor  mt-5">
				
					
				<div class="content-block status_block_top py-5">
					<div class="row no-gutter status_block_icons">
						<div class="col-33 ">
							<img src="resources/images/data.svg" alt="">
							<p class="summary-label">Total Data</p>
							<p>{{totalData}}</p>
						</div>                
						<div class="col-33">
							<img src="resources/images/messages.svg" alt="">
							<p class="summary-label">Total SMS</p>
							<p>{{totalSMS}}</p>
							
						</div> 
						<div class="col-33">
							<img src="resources/images/data.svg" alt="">
							<p class="summary-label">Avg Data</p>
							<p>{{averageData}}</p>                    
						</div>               
					</div>
				</div>
				<div class="summary-block-line"></div>
					<div class="card-header bg-color-darkgray overflow-hidden no-padding text-color-black">
						<div class="progressbar-container"></div>
						<!-- {{@global.LANGUAGE.DASHBOARD_PANEL_MSG43 }} -->						
						<div class="list no-hairlines no-hairlines-between" style="width:100%;" >
							<ul>
								<li class="display-flex">
									
											<div class="item-media">	
												<label for="date-to" class=" px-3">Till</label>
												<input type="text" placeholder="Date" class="pl-3" disabled id = "date-to" value="{{DateTo}}">
											</div>
											<a class="item-link smart-select smart-select-init  w-100 text-color-black" data-open-in="popover" data-close-on-select="true">
										<select name="dashboard-overview-filter" >
											<option value="1" selected>this month</option>     
											<option value="2" >7 days</option>   
											<option value="3" >last month</option>   
											<option value="4" >month to date</option>     
										</select>
										<div class="item-content h-100">
											<div class="item-inner">
												<div class="item-title text-color-black">{{@global.LANGUAGE.DASHBOARD_PANEL_MSG43 }}</div>
												<div class="item-after  text-color-black"></div>
											</div>
										</div>
									</a>
								</li> 
							</ul>
						</div>     
					</div>
					<div class="card-content card-content-padding">
						{{#if DashboardDataLoadedEndUserOverview}}
						<div key="KeyChartGOverview" id="chart-GOverview"></div>      
						{{else}}
						<div key="KeyChartGOverviewLoader" class="absolute-center">
							<div class="preloader color-blue"></div>
						</div>
						{{/if}}   
					</div> 
						<table id="table-report-sim" class="mdl-data-table " style="width:100%">
							<thead>
								<tr>
									<th> Date </th>	
									<th> Data(MB) </th> 
									<th> SMS </th> 		
									<th> Flow </th>							
								</tr>
							</thead>
							<tbody> 
								{{#DashboardDataTable}}
									<tr data-item-index="{{@index}}" >
										<td>{{date}}</td>	  
										<td>{{totalfield}}</td>	
										<td>{{smsfield}}</td>	
										<td>{{flowfield}}</td>									
									</tr>
								{{/DashboardDataTable}}  
							</tbody>
						</table>
					</div>                                                                                                
			</div>
		
		
					
    </div>
</div>
</template>

<script>
  // script must return component object
    return { 
        data: function () {
            var self = this;
            var ret = {
				totalData: 0,
				totalSMS: 0,
				averageData: 0,
				IMSIUsageArray: [],
				totalMB: [],
				DateTo: '',
				myCalendar: false
			};            
            
            /*if (self.$route.query.id) {
				ret.ID = self.$route.query.id;
            } */
			
			if (self.$route.query.imsi) {
				ret.IMSI = self.$route.query.imsi;
            }  			
			
			ret.DashboardDataTableEl = false; 
			ret.DashboardDataTable = [];
			//ret.DashboardDataTable = self.$app.methods.getDashboardDataTableArray();    
            ret.Charts = {
				RealTime: false,
				Overview: false,
				TotalMileage: false,
				FuelUsed: false,
			};
            return ret;
        },
		methods: {
			initReport: function(){
				var self = this;			
				
				var nowFull = moment(); 
				var now = nowFull.clone().startOf('day');
				//var threDaysBeforeFull = nowFull.add(-10, 'days');		
				var threDaysBeforeFull = nowFull.clone().startOf('month');	
				var timeFormat = 'YYYY-MM-DD';
				var start = moment(threDaysBeforeFull,timeFormat).format('YYYY-MM-DD');
				var end = moment(now,timeFormat).format('YYYY-MM-DD');
				console.log(start, end);
				var params = {		
					startDate: start,//+'T00:00:00.000Z',
					endDate: end,//+'T00:00:00.000Z',
					Iccid: self.IMSI,
				};					
				//getActivityData(params, url, '.dataImnsFilters', '#chartSMS', payload);
				
				let urlparams = 'startDate='+ params.startDate + 'T00:00:00.000Z&endDate='+ params.endDate + 'T00:00:00.000Z';
											
				let userInfo = self.$app.methods.getFromStorage('userInfo');
				let accessToken = userInfo.accessToken;		
			
				$.ajax({
					type: "GET",	        
					url: 'https://m2mdata03.sinopacific.com.ua/m2mdata/v3/cdrs/'+ params.Iccid +'?' + urlparams,
					dataType: "json",	
					async: true,
					headers: { 
						Authorization: "Bearer " + accessToken,
					},
					//cache: false,
					success: function (result) {
						//hidePreloader(fromClass);	  
						if(result){		
						let arr = [];
						let chartArr = [];
						let totalData = 0;
						let totalSMS = 0;
						let averageData = 0;
						
						$.each(result, function(index, value1){
							var flowField = 0;
							var smsField = 0;
							var totalField = 0;
							
							if(value1.totals != null  && value1.totals.flow != null){
								var flowField = typeof value1.totals.flow.originalUnits == 'undefined'?0:+value1.totals.flow.originalUnits;
							}
							if(value1.totals != null && value1.totals.sms != null){					
								var smsField = typeof value1.totals.sms.originalUnits == 'undefined'?0:+value1.totals.sms.originalUnits;
							}
							if(value1.totals != null && value1.totals.data != null && value1.totals.data.originalUnits != null){
								var totalField = +(value1.totals.data.originalUnits/1000000).toFixed(3);
							}
							objTemp={'date':value1.date.slice(0, 10),'totalfield':totalField, 'flowfield':flowField, 'smsfield':smsField};
							chartArr.push([value1.date.slice(0, 10), totalField]);
							totalData+=totalField;
							totalSMS+=smsField;
												
							arr.push(objTemp);
						});	
							
						
			
							self.$setState({
								DashboardDataTable: arr,
								totalMB: chartArr,
							});
							
							self.$setState({														
								totalData: totalData.toFixed(3)
							})
							self.$setState({														
								totalSMS: totalSMS
							})
							self.$setState({														
								averageData: (totalData/result.length).toFixed(3)
							})
								
								
								
							self.DashboardDataTableEl = $('body').find('#table-report-sim').DataTable({                    
								columnDefs: [
									{ // remove orederable arrows from column with pin
										targets: [ 0 ], 
										orderable: true,  
									},
									{ // hide group codes, which will be used for filtering
										targets: [ 1 ],
										visible: true
									},
									{ // hide group codes, which will be used for filtering
										targets: [ 2 ],
										visible: true
									},
									{ // hide group codes, which will be used for filtering
										targets: [ 3 ],
										visible: true
									}
								],
								"order": [[ 0, "desc" ]],
								lengthMenu: [5, 10, 25],
								pageLength: 5   
							});
							
							
								self.$app.utils.nextFrame(()=>{
									let wasDataAlreadyLoaded = self.DashboardDataLoadedEndUserOverview;
									self.$setState({
										DashboardDataLoadedEndUserOverview: true,
										EndUser:{Overview: result}
									});
									
									if (wasDataAlreadyLoaded){
										self.updateGraphicsOverviewAndRealTime();
									}else{
										self.initGraphics();
									}
								});
								
						}else{
							console.log('something wrong');
						}
					},
					error: function(XMLHttpRequest, textStatus, errorThrown){
						console.log('can not connect: txt = '+textStatus+' err = '+errorThrown);
					}
				});
	
			},			
			updateGraphicsOverviewAndRealTime: function(){
				let self = this;
				if (self.Charts.Overview && self.EndUser.Overview) {
					let overviewFiletrEl = self.$el.find('[name="dashboard-overview-filter"]');
					
					//update if overview selected for 1 day
					if (overviewFiletrEl && overviewFiletrEl.length && overviewFiletrEl.val() == '1') {	
						let fomattedValues = self.formatGOverviewValues(self.EndUser.Overview);

						self.Charts.Overview.load({
					        columns: [
								['11', 6],
								['22', 7],
								['33', 7],
								['11', 6],
								['22', 7],
								['33', 7],
								['11', 6],
							]
					    });
					}					
				}
				/*if (self.Charts.RealTime && self.RealtimeOnline) {									
					self.Charts.RealTime.load({
					    columns: [
							[LANGUAGE.DASHBOARD_PANEL_MSG28, self.RealtimeOnline.Online],
							[LANGUAGE.DASHBOARD_PANEL_MSG29, self.RealtimeOnline.Offline]
						]
					});					
				}*/
			},
			
			initGraphics: function(){
				let self = this;
				
				let columnsOverview = [
						['m', 0], //moving
						['w', 0], //stoped
						['e', 0], //idle,=
						['m', 0], //moving
						['w', 0], //stoped
						['e', 0], //idle
						['m', 0], //moving
					];	
					if (self.EndUser && self.EndUser.Overview) {
						let fomattedValues = self.formatGOverviewValues(self.EndUser.Overview);
						columnsOverview = [
							['yy', 15],
							['ii', 91],
							['o', 24],
							['d', 0.6],
							['i', 9],
							['oi', 0.6],
							['y2', 0.10],
						];

						for (var i = self.EndUser.Overview.length - 1; i >= 0; i--) {
							/*if (POSINFOASSETLIST[self.EndUser.Overview[i].IMEI]) {
								columnsTotalMileage.push( [ POSINFOASSETLIST[self.EndUser.Overview[i].IMEI].Name, parseFloat(self.EndUser.Overview[i].Mileage).toFixed(2) ] );
								columnsFuelUsed.push( [ POSINFOASSETLIST[self.EndUser.Overview[i].IMEI].Name, parseFloat(self.EndUser.Overview[i].Fuel).toFixed(2) ] );
							}*/							
						}
					}					

					self.buildGraphics({
						GOverview: {
							bindto: '#chart-GOverview',
							columns: columnsOverview,
						},												
					});
				
			},
			formatGOverviewValues: function(arr){
				let ret = {
					stop: 1,
					move: 3,
					idle: 7,
					//mileage: 0,
					//fuel: 0
				}

				if (arr && arr.length) {
					for (var i = arr.length - 1; i >= 0; i--) {
						ret.stop += arr[i].Stop;
						ret.move += arr[i].Move;
						ret.idle += arr[i].Idle;
						//ret.fuel += arr[i].fuel;
						//ret.mileage += arr[i].mileage;
					}
				}

				return ret;
			},
			
			buildGraphics: function(params){
				//console.log(params.GRealTimeOnline);
				var self = this;
				if (params) {
					

					if (params.GOverview && params.GOverview.bindto) {
						self.Charts.Overview = c3.generate({
							bindto: params.GOverview.bindto,
							size: {                                
								height: 180,                       
							},
							color: {
								pattern: ['#4dc08e']//, 10aef8'#f96868', '#f9b256'
							},	
							data: {                                
                                columns: self.totalMB,//params.GOverview.columns,                        
                                type : 'bar',   
                                labels: false                             
                            },
                            bar: {
                                width: {
                                    ratio: 1 // this makes bar width 50% of length between ticks
                                },
                                space: 0.25
                            },
                            axis: {
                                x: { 
                                    show: false,
                                    type: 'category',
                                    categories: ['mb/day'],//params.GTotalMileage.name
                                },
                                y: { show: false }
                            },
                            legend: {
                                show: false
                            },
							
							tooltip: {
						        /*format: {
						            //title: function (d) { return 'Data ' + d; },
						            value: function (value, ratio, id) {
						                return TimeSpan(value*1000).format("^hh:mm:ss");
						            }
							
						        }*/
						    }							
						});
					}	
			
				}						
			},
			
			getOverviewDetails: function(days = 1){
				let self = this;
				self.DashboardDataTableEl.destroy();
				self.DashboardDataTableEl = false;
				
				self.Charts.Overview = false;
								
				let urlparams = '';				
				var nowFull = moment(); 
				var now = nowFull.clone().startOf('day');
				var timeFormat = 'YYYY-MM-DD';
				var startTime, endTime;
				
				switch(days){
	                case '1':	 		
						startTime = nowFull.clone().startOf('month');
						endTime = now;
					break;
					case '2':					
						startTime = nowFull.add(-7, 'days');	
						endTime = now;
					break;
					case '3':						
						startTime = nowFull.add(-30, 'days');	
						endTime = now;
					break;
					default:								
						var newDateTo = $('.report-page').find('#date-to').val();
						var newFull = moment(newDateTo); 			
						startTime = moment(newDateTo).add(-30, 'days');	
						endTime = newFull;					
						console.log(startTime, endTime);
				}
				
				var start = moment(startTime,timeFormat).format('YYYY-MM-DD');
				var end = moment(endTime,timeFormat).format('YYYY-MM-DD');
				
				self.$setState({
					DateTo: end
				});
				
				
				var params = {		
					startDate: start,//+'T00:00:00.000Z',
					endDate: end,//+'T00:00:00.000Z',
					Iccid: self.IMSI,
				};	
				urlparams = 'startDate='+ params.startDate + 'T00:00:00.000Z&endDate='+ params.endDate + 'T00:00:00.000Z';	
				
				let userInfo = self.$app.methods.getFromStorage('userInfo');
				let accessToken = userInfo.accessToken;		
			
				
						
						
				$.ajax({
					type: "GET",	        
					url: 'https://m2mdata03.sinopacific.com.ua/m2mdata/v3/cdrs/'+ params.Iccid +'?' + urlparams,
					dataType: "json",	
					async: true,
					headers: { 
						Authorization: "Bearer " + accessToken,
					},
					//cache: false,
					success: function (result) {
						//hidePreloader(fromClass);	  
						if(result){		
						let arr = [];
						let chartArr = [];
						let totalData = 0;
						let totalSMS = 0;
						let averageData = 0;
						
						$.each(result, function(index, value1){
							var flowField = 0;
							var smsField = 0;
							var totalField = 0;
							
							if(value1.totals != null  && value1.totals.flow != null){
								var flowField = typeof value1.totals.flow.originalUnits == 'undefined'?0:+value1.totals.flow.originalUnits;
							}
							if(value1.totals != null && value1.totals.sms != null){					
								var smsField = typeof value1.totals.sms.originalUnits == 'undefined'?0:+value1.totals.sms.originalUnits;
							}
							if(value1.totals != null && value1.totals.data != null && value1.totals.data.originalUnits != null){
								var totalField = +(value1.totals.data.originalUnits/1000000).toFixed(3);
							}
							objTemp={'date':value1.date.slice(0, 10),'totalfield':totalField, 'flowfield':flowField, 'smsfield':smsField};
							chartArr.push([value1.date.slice(0, 10), totalField]);
							
							totalData+=totalField;
							totalSMS+=smsField;
																	
							arr.push(objTemp);
						});	
							
						
			/*let fomattedValues = self.formatGOverviewValues(data);

							self.Charts.Overview.load({
						        columns: [
									[LANGUAGE.DASHBOARD_PANEL_MSG54, fomattedValues.move],
									[LANGUAGE.DASHBOARD_PANEL_MSG52, fomattedValues.stop],
									[LANGUAGE.DASHBOARD_PANEL_MSG53, fomattedValues.idle],
								]
						    });*/
							
							
							self.$setState({
								DashboardDataTable: arr,
								totalMB: chartArr
							});
							
							
							self.$setState({														
								totalData: totalData.toFixed(3)
							})
							self.$setState({														
								totalSMS: totalSMS
							})
							self.$setState({														
								averageData: (totalData/result.length).toFixed(3)
							})
								
								
							
							self.DashboardDataTableEl = $('body').find('#table-report-sim').DataTable({                    
								columnDefs: [
									{ // remove orederable arrows from column with pin
										targets: [ 0 ], 
										orderable: true,  
									},
									{ // hide group codes, which will be used for filtering
										targets: [ 1 ],
										visible: true
									},
									{ // hide group codes, which will be used for filtering
										targets: [ 2 ],
										visible: true
									},
									{ // hide group codes, which will be used for filtering
										targets: [ 3 ],
										visible: true
									}
								],
								"order": [[ 0, "desc" ]],
								lengthMenu: [5, 10, 25],
								pageLength: 5   
							});
							
							self.Charts.Overview = c3.generate({
							bindto: '#chart-GOverview',
							size: {                                
								height: 180,                       
							},
							color: {
								pattern: ['#4dc08e']//, 10aef8'#f96868', '#f9b256'
							},	
							data: {                                
                                columns: self.totalMB,//params.GOverview.columns,                        
                                type : 'bar',   
                                labels: false                             
                            },
                            bar: {
                                width: {
                                    ratio: 1 // this makes bar width 50% of length between ticks
                                },
                                space: 0.25
                            },
                            axis: {
                                x: { 
                                    show: false,
                                    type: 'category',
                                    categories: ['mb/day'],//params.GTotalMileage.name
                                },
                                y: { show: false }
                            },
                            legend: {
                                show: false
                            },
							
							tooltip: {
						        /*format: {
						            //title: function (d) { return 'Data ' + d; },
						            value: function (value, ratio, id) {
						                return TimeSpan(value*1000).format("^hh:mm:ss");
						            }
							
						        }*/
						    }							
						});
/*						
							self.$app.utils.nextFrame(()=>{
								self.Charts.Overview.load({
									columns:  self.totalMB
								});
							});*/
							/*
							self.DashboardDataTableEl = $('body').find('#table-report-sim').DataTable({                    
								columnDefs: [
									{ // remove orederable arrows from column with pin
										targets: [ 0 ], 
										orderable: false,  
									},
									{ // hide group codes, which will be used for filtering
										targets: [ 1 ],
										visible: true
									},
									{ // hide group codes, which will be used for filtering
										targets: [ 2 ],
										visible: true
									},
									{ // hide group codes, which will be used for filtering
										targets: [ 3 ],
										visible: true
									}
								],
								lengthMenu: [5, 10, 25],
								pageLength: 5   
							});
							
							
								self.$app.utils.nextFrame(()=>{
									let wasDataAlreadyLoaded = self.DashboardDataLoadedEndUserOverview;
									self.$setState({
										DashboardDataLoadedEndUserOverview: true,
										EndUser:{Overview: result}
									});
									
									if (wasDataAlreadyLoaded){
										console.log('111');
										//self.updateGraphicsOverviewAndRealTime();
									}else{
										console.log('222');
										//self.initGraphics();
									}
								});
								*/
						}else{
							console.log('something wrong');
						}
					},
					error: function(XMLHttpRequest, textStatus, errorThrown){
						console.log('can not connect: txt = '+textStatus+' err = '+errorThrown);
					}
				});
				
				//self.changeGraphicData('', selectName);
				/*let userInfo = self.$app.methods.getFromStorage('userInfo'); 
				let data = {
					MajorToken: userInfo.MajorToken,
					MinorToken: userInfo.MinorToken,	
					Days: days	
				};
				let progressbarContainer = self.$el.find('select[name = '+selectName+']').closest('.card').find('.progressbar-container');				
				
				self.$app.progressbar.show(progressbarContainer, 'red');
				self.$app.request.post(API_URL.GET_DASHBOARD_OVERVIEW_INFO, data, function (result, xhr, status) {
					self.$app.progressbar.hide(progressbarContainer); 
                                   
                    console.log(result);
                    if (result && result.MajorCode == '000' && selectName) {
                    	self.changeGraphicData(result.Data, selectName);	                    
                    }                    
                },
                function (xhr, status) {            
                    self.$app.progressbar.hide(progressbarContainer); 
                    self.$app.dialog.alert('Error occured at getOverviewDetails');                
                },
                'json');  */
			},
			
			changeGraphicData: function(data=[], selectName){
				let self = this;
				
				if (data.length && selectName) {
					let columns = [];
					switch(selectName){
	                    case 'dashboard-total-mileage-filter':							
							for (var i = data.length - 1; i >= 0; i--) {
								columns.push( [ POSINFOASSETLIST[data[i].IMEI].Name, parseFloat(data[i].Mileage).toFixed(2) ] );
							}
							self.Charts.TotalMileage.load({
							    columns: columns
							});			

	                    	break;

	                    case 'dashboard-total-fuel-filter':
	                    	for (var i = data.length - 1; i >= 0; i--) {								
								columns.push( [  POSINFOASSETLIST[data[i].IMEI].Name, parseFloat(data[i].Fuel).toFixed(2) ] );
							}
							self.Charts.FuelUsed.load({
							    columns: columns
							});
	                    	break;

	                    case 'dashboard-overview-filter':
	                    	let fomattedValues = self.formatGOverviewValues(data);

							self.Charts.Overview.load({
						        columns: [
									[LANGUAGE.DASHBOARD_PANEL_MSG54, fomattedValues.move],
									[LANGUAGE.DASHBOARD_PANEL_MSG52, fomattedValues.stop],
									[LANGUAGE.DASHBOARD_PANEL_MSG53, fomattedValues.idle],
								]
						    });
	                    	break;
	                }   
				}else{
}				
			},

		},
        on: {
            pageInit: function (e, page) {  
				var self = this;        
				
				self.$app.actions.close();
				self.$app.sheet.close();
				
				var thisPage = page.$el.find('.page-content'); 					
				let overviewFiletrEl = self.$el.find('[name="dashboard-overview-filter"]');
				
				var current = moment(); 
				var currentDay = current.clone().startOf('day');
				currentDay = moment(currentDay).format('YYYY-MM-DD');
				
				self.$setState({
					DateTo: currentDay
				});
				
				/*self.initReport();
				
				self.myCalendar = self.$app.calendar.create({
					inputEl: '#date-to',
					on: {
						closed: function () {
							self.getOverviewDetails('4');
						}
					  }
				});				
				
				overviewFiletrEl.on('change', function(e){ console.log(e)
					if(e.target.value == '4'){
						self.$app.utils.nextFrame(()=>{							
							$('.report-page').find('#date-to').attr('disabled', false);
							self.myCalendar.open();
						});
					}else{
						$('.report-page').find('#date-to').attr('disabled', true);
						self.getOverviewDetails(e.target.value);
					}
				});
				*/
				
			}
		}
    };
</script>
    