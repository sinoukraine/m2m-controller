<!--suppress JSAnnotator -->
<template>
	<div data-name="sim-status" class="page sim-status-page"> <!-- page-with-subnavbar -->
		<!-- Top Navbar -->
		<div class="navbar">
            <div class="navbar-bg"></div>
            <div class="navbar-inner">
                <div class="left">
                    <a href="#" class="back link icon-only " >
                        <i class="icon material-icons">arrow_back</i>
                    </a>
                </div>
                <div class="title sliding">
                    SIM Status
                </div>
                <div class="right">
                    <a href="#" class="link icon-only openSettings px-0" >
                        <i class="material-icons md-36">settings</i>
                    </a>
                </div>
            </div>
        </div>
		
		<div class="page-content">
			<div class="inner-content">
				<div class="sim-status-top">					
					<div class="sim-status-bottom-info">
						<div class="text-content">{{Description}}</div>
						<div class="text-content">{{SIMName}}</div>
						<div class="text-content">IMSI: {{IMSI}}</div>
						<div class="text-content">ICCID: {{ICCID}}</div>
						<div class="text-content">Owner: {{owner}}</div>
					</div>
					<img class="sim-icon" src="./resources/images/sim.svg" alt="main">
					<div class="big-round {{sessionActivityBg}}"></div >
					<div class="sim-status-top-info">
						<div class="text-content {{sessionActivityColor}}">{{sessionActivity}}</div>
						<div class="text-content">{{#if lastUpdateTime}}(last update: {{lastUpdateTime}} ) {{else}} {{/if}}</div>
					</div>
				</div>
				<div class="content-block status_block_top">
					<div class="row no-gutter status_block_icons">
						<div class="col-33 ">
							<img src="resources/images/data.svg" alt="">
							<p>{{dataInfo}} MB</p>
						</div>                
						<div class="col-33">
							<img src="resources/images/date.svg" alt="">
							<p>{{dateInfo}}</p>
							
						</div> 
						<div class="col-33">
							<img src="resources/images/messages.svg" alt="">
							<p>{{messagesInfo}}</p>                    
						</div>               
					</div>
				</div>
				
				
				<div class="list no-y-margin mb-5" >
				
					<ul>
						<!-- Default Setup -->
						<li class="state-block display-none">
						  <a class="item-link smart-select smart-select-0 smart-select-init ">
							<select name="sim-state">
							<option value="Current" id="state-3" selected>Current {{state}}</option>
							
							
							
						{{#if onlyActivate }}
							<option value="Activate" id="state-4" >Activate</option>							
						{{else}}
							<option value="Activate" id="state-4" disabled>Activate</option>
						{{/if }}
						
						{{#if onlySuspend }}
							<option value="Suspend" id="state-0">Suspend</option>							
						{{else}}
							<option value="Suspend" id="state-0" disabled>Suspend</option>
						{{/if }}
						
						{{#if onlyResume }}
							<option value="Resume" id="state-1">Resume</option>							
						{{else}}
							<option value="Resume" id="state-1" disabled>Resume</option>
						{{/if }}
						
						{{#if onlyTerminate }}
							<option value="Terminate" id="state-2" >Terminate</option>							
						{{else}}
							<option value="Terminate" id="state-2" disabled>Terminate</option>
						{{/if }}
						
						
						
							  
							  
							 <!--<option value="OnStock" id="state-0">{{onstockTitle}}</option>
							  <option value="Productive" id="state-1">{{productiveTitle}}</option>
							  <option value="Suspended" id="state-2" >{{suspendedTitle}}</option>
							  <option value="Activated" id="state-3" >Activated</option>
							  <option value="Deleted" id="state-4">{{terminatedTitle}}</option>
							  <option value="Ordered" id="state-5" >Ordered</option>
							  <option value="Test" id="state-6" >Test</option>
							  <option value="TestProductive" id="state-7" >TestProductive</option>
							  <option value="TestEnd" id="state-8" >TestEnd</option>
							  <option value="AutoSuspended" id="state-9" >AutoSuspended</option>
							  <option value="Paused" id="state-10" >Paused</option>
							  <option value="Lost" id="state-11" >Lost</option>
							  <option value="Reserved" id="state-12" >Reserved</option>
							  <option value="Deleting" id="state-13" >Deleting</option>
							  <option value="EuiccControl" id="state-14" >EuiccControl</option>
							  <option value="Passive" id="state-15" >Passive</option>-->
							</select>
							<div class="item-content">
							  <div class="item-inner">
								<div class="item-title">State</div>
							  </div>
							</div>
						  </a>
						</li>
						<li class="state-block display-none">
						  <a class="item-link smart-select smart-select-1 smart-select-init ">
							<select name="sim-csp" class="list  ">							  
							  <option value="M2M Data" id="state--0">M2M Data</option>
							  <option value="M2M Data Normal CSP Z1 &2" id="state--1">M2M Data Normal CSP Z1 &2</option>
							  <option value="M2M Data High CSP Z1-3" id="state--2">M2M Data High CSP Z1-3</option>
							  <option value="M2M Data Emergency CSP Z1- 9" id="state--3">M2M Data Emergency CSP Z1- 9</option>
							  <option value="M2M Data Custom Network Profile Australia" id="state--4">M2M Data Custom Network Profile Australia</option>
							</select>
							<div class="item-content">
							  <div class="item-inner">
								<div class="item-title">CSP</div>
							  </div>
							</div>
						  </a>
						</li>
						<!--<li class="state-block display-none">
						  <a class="item-link smart-select smart-select-1 smart-select-init ">
							<select name="sim-state" class="list home-list customerList">							  
							  {{#each customers}}
                                <option value="{{val}}" data-display-as="{{displayAs}}" {{#if selected}} selected {{/if}}>{{name}}</option>
                                {{/each}}
							</select>
							<div class="item-content">
							  <div class="item-inner">
								<div class="item-title">Customer</div>
							  </div>
							</div>
						  </a>
						</li>
						<li>
							<div class="text-editor-content desc-editor" style="margin: 15px;padding-bottom: 15px; " contenteditable></div>
						</li>-->
					</ul>
					
				
						{{#if loading }}
						
								<div key="KeyChartGOverviewLoader" class="absolute-center" style="padding-top:10px">
									<div class="preloader color-blue"></div>
								</div>
							
							
							{{/if}} 
				</div>
				
				
				
			</div>
		</div>
		<div class="location-div display-none">
			<button class="col button button-outline currentLocation" >Show location</button>
		</div>
		<div class="cells-div">
			<button class="col button button-fill resetNetwork" >Force Reconnect</button>
		</div>
    </div>
</template>

<script>
  // script must return component object
  const curday = new Date()	
  
    return { 
        data: function () {
            var self = this;
            var ret = {
				loading: true,
				sessionActivity: self.$route.query.state,
				sessionActivityColor: 'color-status-grey',
				sessionActivityBg: 'bg-status-grey',
				lastUpdateTime: '',
				onstockTitle: 'OnStock',
				productiveTitle: 'Productive',
				suspendedTitle: 'Suspended',
				terminatedTitle: 'Deleted',
				modifiedTitle: 'Modified',
				obj: {},
				Description: '',
				lat: '0',
				lng: '0',
				towerArr: [],
				dataInfo: 0,
				dateInfo: 0,
				virtualCustomerList: false,
				messagesInfo: 0,
				statusInfo: '',
				cspInfo: '',
				customers: [],
				selectedCustomer: 'uui'
			};         
			
			if (self.$route.query.imsi) {
				ret.IMSI = self.$route.query.imsi;
            }  			
            
			if (self.$route.query.iccid) {
				ret.ICCID = self.$route.query.iccid;
            }  					
            
			if (self.$route.query.owner) {
				ret.owner = self.$route.query.owner;
            }  		
			if (self.$route.query.csp) {
				ret.csp = self.$route.query.csp;
            }  			
			if (self.$route.query.state) {
				ret.state = self.$route.query.state;
            }  			
            return ret;
        },
		methods: {
			resetNetwork: function () {			
				var self = this;
				
				var query = {
				  IMSIs: [self.IMSI]
				}
				
				var settings = {
				  "url": "https://test.m2mdata.co/JT/Sim/Reboot",
				  "method": "POST",
				  "timeout": 0,
				  "headers": {
					"token": "00000000-0000-0000-0000-000000000000",
					"Content-Type": "application/x-www-form-urlencoded"
				  },
				  "data": query
				};

				$.ajax(settings).done(function (result) {
					self.resetOK.open();
				})
			},	
			getSim: async function (payload) {			
				var self = this;

				$('.state-block').removeClass('display-none');
				
				self.$setState({
					loading: false									
				});				
				
				
				var listQuery = {
					IMSIs: [self.IMSI]
				}
				
				var settings = {
				  "url": "https://test.m2mdata.co/JT/Sim/Query",
				  "method": "POST",
				  "timeout": 0,
				  "headers": {
					"token": "00000000-0000-0000-0000-000000000000",
					"Content-Type": "application/x-www-form-urlencoded"
				  },
				  "data": listQuery
				};
				
                                var currentTime = moment();
				var halfDayAgo = moment(currentTime, 'YYYY-MM-DD HH').add(-12, 'hours').format('YYYY-MM-DD HH'); 
                  var oneDayAgo = moment(currentTime, 'YYYY-MM-DD HH').add(-1, 'days').format('YYYY-MM-DD HH'); 
                                var threeDayAgo = moment(currentTime, 'YYYY-MM-DD HH').add(-3, 'days').format('YYYY-MM-DD HH');
                                
								$.ajax(settings).done(function (result) {
					let objProfile = result.rows[0]
				
					self.sessionActivity = objProfile.State
					console.log('objProfile',objProfile)
					/*if(objProfile.State == 'Suspended'){
					  self.sessionActivityBg = 'bg-status-yellow'
						self.sessionActivityColor = 'color-status-yellow'
					}else*/ if(objProfile.SMSMOUpdateTime == null && objProfile.DataUpdateTime == null){
					  self.sessionActivityBg = 'bg-status-grey'
					self.sessionActivityColor = 'color-status-grey'
					  if(objProfile.State == 'Productive' || objProfile.State == 'TestProductive'){
						/*self.sessionActivityBg = 'bg-status-blue'
						self.sessionActivityColor = 'color-status-blue'*/
						self.sessionActivity = objProfile.State + ', but no current data session'
					  }
					}else if(objProfile.DataUpdateTime == null){
					  self.sessionActivityBg = 'bg-status-grey'
					self.sessionActivityColor = 'color-status-grey'
					  if(objProfile.State == 'Productive' || objProfile.State == 'TestProductive'){
						/*self.sessionActivityBg = 'bg-status-blue'
					self.sessionActivityColor = 'color-status-blue'*/
						self.sessionActivity = objProfile.State + ', but no current data session'
					  }
					}else{
					 // const simActivityTime = moment(objProfile.DataUpdateTime, 'YYYY-MM-DD').format('YYYY-MM-DD')
					  
					  
					  const simActivityTime = moment(objProfile.DataUpdateTime, 'YYYY-MM-DD HH').format('YYYY-MM-DD HH')
						self.lastUpdateTime = objProfile.DataUpdateTime.replace("T", " ").replace("Z", "")
					  
					  if(simActivityTime >= halfDayAgo){
									self.sessionActivityBg = 'bg-status-green'
									self.sessionActivityColor = 'color-status-green'
								  }else if(simActivityTime >= oneDayAgo && simActivityTime < halfDayAgo){
									self.sessionActivityBg = 'bg-status-yellow'
									self.sessionActivityColor = 'color-status-yellow'
								  }else {
									self.sessionActivityBg = 'bg-status-red'
									self.sessionActivityColor = 'color-status-red'
								  }
					  
					  /*if(simActivityTime >= oneDayAgo){
						self.sessionActivityBg = 'bg-status-green'
					self.sessionActivityColor = 'color-status-green'
					  }else {
						self.sessionActivityBg = 'bg-status-yellow'
					self.sessionActivityColor = 'color-status-yellow'
					  }*/
					}
				});
				
				/*const token = "00000000-0000-0000-0000-000000000000"
				const oneDayAgo = moment(curday, 'YYYY-MM-DD').add(-1, 'days').format('YYYY-MM-DD')
				const threeDayAgo = moment(curday, 'YYYY-MM-DD').add(-3, 'days').format('YYYY-MM-DD')
				const weekAgo = moment(curday, 'YYYY-MM-DD').add(-7, 'days').format('YYYY-MM-DD')
				
				const responseActiveSession = await fetch(`https://m2mdata.co/jt/GetActiveSession?imsi=${self.IMSI}`)
				let resActiveSession = await responseActiveSession.json()
				
				console.log(resActiveSession)
				if(resActiveSession.Data){
					self.lastUpdateTime = resActiveSession.Data.startDateField.replace("T", " ").replace("Z", "")
				
					const simActivityTime = moment(self.lastUpdateTime, 'YYYY-MM-DD').format('YYYY-MM-DD')
					console.log('comp', simActivityTime, oneDayAgo)
				  if(simActivityTime > oneDayAgo){
					self.sessionActivity = 'Productive'
					self.sessionActivityColor = 'color-status-blue'
					self.sessionActivityBg = 'bg-status-blue'
				  }else if(simActivityTime <= oneDayAgo && simActivityTime > threeDayAgo){
					self.sessionActivity = 'Active'
					self.sessionActivityColor = 'color-status-green'
					self.sessionActivityBg = 'bg-status-green'
				  }else if(simActivityTime <= threeDayAgo){             
					self.sessionActivity = 'Suspended'
					self.sessionActivityColor = 'color-status-yellow'
					self.sessionActivityBg = 'bg-status-yellow'
				  }else{ 
					self.sessionActivity = 'Productive, but no current data session'
					self.sessionActivityColor = 'color-statusr-blue'
					self.sessionActivityBg = 'bg-status-blue'
				  }
				}else{
					self.sessionActivity = 'Productive, but no current data session'
					self.sessionActivityColor = 'color-status-blue'
					self.sessionActivityBg = 'bg-status-blue'					
				}*/
						

				self.$app.preloader.hide();						
								
				/*var settings = {
				  "url": "https://m2mdata.co/jt/GetGetHlrInfo?imsi=" + self.IMSI,
				  "method": "GET",
				  "timeout": 0,
				  "headers": {
					"token": "00000000-0000-0000-0000-000000000000",
					"Content-Type": "application/x-www-form-urlencoded"
				  },
				};

				$.ajax(settings).done(function (result) {
					console.log('hlr',JSON.parse(result));
				})*/
					
			},					
			loadTrackPage: function () {
				var self = this;
				var queryLBS = {
				  imsi: [self.IMSI]
				}
				
				var settingsLBS = {
				  "url": "https://test.m2mdata.co/JT/Sim/QueryLBSInfo",
				  "method": "POST",
				  "timeout": 0,
				  "headers": {
					"token": "00000000-0000-0000-0000-000000000000",
					"Content-Type": "application/x-www-form-urlencoded"
				  },
				  "data": queryLBS
				};

				$.ajax(settingsLBS).done(function (result) {
				  const query_1 = {
					lat: result.Data.LbsLat,
					lon: result.Data.LbsLng
				  }
				  var  lng = result.Data.LbsLng, lat= result.Data.LbsLat;
								
								self.$setState({
									lat
								});		
								self.$setState({
									lng
								});		
								
								$('.location-div').removeClass('display-none');
					})
				
					
					
			},
			initSimInfo: function () {
                let self = this;
									
				/*~~~~~~~today let userInfo = self.$app.methods.getFromStorage('userInfo');
				let accessToken = userInfo.accessToken;		
				
					$.ajax({
						type: "GET",		        
						url: API_URL.URL_GET_COMMAND_HISTORY + self.ID + '/sms', 
						dataType: "json",	
						async: true,
						//cache: false,
						headers: { 
							Authorization: "Bearer " + accessToken,
						},
						success: function (result) {
							if(result){
								self.$setState({
									messagesInfo: result.length,
								});		
							}else{
								console.log('something wrong');
							}
						},
						error: function(XMLHttpRequest, textStatus, errorThrown){
							console.log('can not connect: txt = '+textStatus+' err = '+errorThrown);
						}
					});
					
					$.ajax({
						type: "GET",		        
						url: 'https://m2mdata03.sinopacific.com.ua/api/v3/sims/'+ self.ID +'/cdrs/', 
						dataType: "json",	
						async: true,
						//cache: false,
						headers: { 
							Authorization: "Bearer " + accessToken,
						},
						success: function (result) {
							if(result){
								//mb usage & last activity time
								var total = 0;
								var dates = [];
								
								$.each(result, function(index, value){										
									var mb = 0;
									if(value.totals != null && value.totals.data != null && value.totals.data.originalUnits != null){
										mb = value.totals.data.originalUnits;
									}
									total = total + mb;
									dates.push(new Date(value.date));
								});
								
								var maxDate = new Date(Math.max.apply(null, dates));
								var maxDate = moment.utc(maxDate).toDate();
									maxDate = moment(maxDate).format(window.COM_TIMEFORMAT);
											
								self.$setState({
									dataInfo: (total/1000000).toFixed(3),
								});
								
								self.$setState({
									dateInfo: maxDate.substr(0, maxDate.length - 6).replace("T", " "),
								});
								
							}else{
								console.log('something wrong');
							}
						},
						error: function(XMLHttpRequest, textStatus, errorThrown){
							console.log('can not connect: txt = '+textStatus+' err = '+errorThrown);
						}
					});*/
            },
			setNewCSP: function (state) {
                let self = this;				
				
				if(self.cspInfo != state){
				var query = {
				  ServiceProfileCode: state,
				  IMSIs: [self.IMSI]
				}
				
				
				var settings = {
				  "url": "https://test.m2mdata.co/JT/Sim/SetSimServiceProfile",
				  "method": "POST",
				  "timeout": 0,
				  "headers": {
					"token": "00000000-0000-0000-0000-000000000000",
					"Content-Type": "application/x-www-form-urlencoded"
				  },
				  "data": query
				};

		
				$.ajax(settings).done(function (result) {
		
							console.log('ok',result);
							self.notificationFull1.open();
							
						})
				
				
			
				}
			},
			setNewState: function (state) {
                let self = this;
				
				var query = {
				  IMSIs: [self.IMSI]
				}
						
				
				switch(state){
						case 'Suspend':	
							
							var settingsSuspend = {
								  "url": "https://test.m2mdata.co/JT/Sim/Suspend",
								  "method": "POST",
								  "timeout": 0,
								  "headers": {
									"token": "00000000-0000-0000-0000-000000000000",
									"Content-Type": "application/x-www-form-urlencoded"
								  },
								  "data": query
								};

				
								$.ajax(settingsSuspend).done(function (result) {
						
									console.log('ok',result);
									self.notificationFull.open();
									
								})
					
						break;
						case 'Resume':							
							
							var settingsResume = {
								  "url": "https://test.m2mdata.co/JT/Sim/Suspend",
								  "method": "POST",
								  "timeout": 0,
								  "headers": {
									"token": "00000000-0000-0000-0000-000000000000",
									"Content-Type": "application/x-www-form-urlencoded"
								  },
								  "data": query
								};

						
								$.ajax(settingsResume).done(function (result) {
							
									console.log('okk00',result);
									self.notificationFull.open();
									
								})
							
						break;
						case 'Terminate':	
						
							var settingsTerminate = {
								  "url": "https://test.m2mdata.co/JT/Sim/Suspend",
								  "method": "POST",
								  "timeout": 0,
								  "headers": {
									"token": "00000000-0000-0000-0000-000000000000",
									"Content-Type": "application/x-www-form-urlencoded"
								  },
								  "data": query
								};

							
								$.ajax(settingsTerminate).done(function (result) {
							
									console.log('ok',result);
									self.notificationFull.open();
									
								})
						
						break;
						case 'Activate':

							var queryActivate = {								
								ServiceProfileCode: state,
								IMSIs: [self.IMSI]
							}
							
							var settingsActivate = {
								  "url": "https://test.m2mdata.co/JT/Sim/Activate",
								  "method": "POST",
								  "timeout": 0,
								  "headers": {
									"token": "00000000-0000-0000-0000-000000000000",
									"Content-Type": "application/x-www-form-urlencoded"
								  },
								  "data": queryActivate
								};

								$.ajax(settingsActivate).done(function (result) {
						
									console.log('ok',result);
									self.notificationFull.open();
									
								})
						
						break;
						default:
							
					}
				
					
					
				
			},
		},
        on: {
            pageInit: function (e, page) {  
				var self = this;        
				self.$app.actions.close();
				self.$app.sheet.close();
				
				self.$app.preloader.show();
				self.getSim();
				
				
						self.notificationFull = self.$app.notification.create({
								  //icon: '<i class="icon demo-icon">7</i>',
								  title: 'M2M Data Controller',
								  //titleRightText: 'now',
								  subtitle: 'SIM State Notification',
								  text: 'State was changed successfully. ',
								  closeTimeout: 3000,
								});
								
								self.notificationFull1 = self.$app.notification.create({
								  //icon: '<i class="icon demo-icon">7</i>',
								  title: 'M2M Data Controller',
								  //titleRightText: 'now',
								  subtitle: 'Modify CSP Notification',
								  text: 'CSP was changed successfully. ',
								  closeTimeout: 3000,
								});
								
								self.resetOK = self.$app.notification.create({
								  //icon: '<i class="icon demo-icon">7</i>',
								  title: 'M2M Data Controller',
								  //titleRightText: 'now',
								  subtitle: 'SIM State Notification',
								  text: 'Sim connection refreshed',
								  closeTimeout: 3000,
								});
				
				$('.currentState').on('click', function(){						
					mainView.router.navigate('/set-status/?imsi='+self.IMSI);
				});
				
				$('.openSettings').on('click', function(){						
					mainView.router.navigate('/settings/');//?id='+self.ID
				});
				
				$('.sim-status-page').find('.currentLocation').on('click', function(){		
					console.log('ok')
					dynamicPopup.open();
							
				});
				
				$('.resetNetwork').on('click', function(){						
					self.resetNetwork();							
				});
				
													
				var boatMarker = L.icon({
					iconUrl: 'resources/images/pin.svg',                       
					//iconSize:     [50, 50], // size of the icon                        
					//iconAnchor:   [50, 99], // point of the icon which will correspond to marker's location                        
					//popupAnchor:  [0, -50] // point from which the popup should open relative to the iconAnchor    
					iconSize:     [50, 50], // size of the icon                        
					//iconAnchor:   [50, 99], // point of the icon which will correspond to marker's location    
					iconAnchor:   [17, 55],
					popupAnchor:  [0, -50] // point from which the popup should open relative to the iconAnchor   
				});		

				var towerMarker = L.icon({
					iconUrl: 'resources/images/tower-map.svg',                       
					//iconSize:     [50, 50], // size of the icon                        
					//iconAnchor:   [50, 99], // point of the icon which will correspond to marker's location                        
					//popupAnchor:  [0, -50] // point from which the popup should open relative to the iconAnchor    
					iconSize:     [50, 50], // size of the icon                        
					//iconAnchor:   [50, 99], // point of the icon which will correspond to marker's location    
					iconAnchor:   [17, 55],
					popupAnchor:  [0, -50] // point from which the popup should open relative to the iconAnchor   
				});		
				


				self.loadTrackPage();
				
				var dynamicPopup = self.$app.popup.create({
								  content: '<div class="page popup-tablet-fullscreen popup">'+
										'<div class="page-content">'+
										'	<div class="position_map "> '+
										'		<div class="map" id="map"></div>'+
										'	</div>'+
										'</div>'+
									'</div>',
								  on: {
									open: function (popup) {									
									  //console.log('Popup open');
										
				//	
										console.log(self.lat, parseFloat(self.lng))
										if (self.lat !== 0 && parseFloat(self.lng) !== 0) {            
										
											var marker = L.marker([self.lat, self.lng], {icon: boatMarker}); 
											marker.setLatLng([self.lat, self.lng]);
											MapTrack = Protocol.Helper.createMap({ target: 'map', latLng: [self.lat,self.lng], zoom: 14 });        
											marker.addTo(MapTrack);
											
											$.each(self.towerArr, function(index, value){										
												var tower = L.marker([value.lat, value.lng], {icon: towerMarker}); 
												tower.setLatLng([value.lat, value.lng]);        
												tower.addTo(MapTrack);
											});
											
											//self.$app.preloader.hide();
										}else{
											self.$app.dialog.alert('Currently there are no coordinates for this IMSI. Please try again later');
											dynamicPopup.close();
										}
										
									},
									opened: function (popup) {
									  //console.log('Popup opened');
									},
								  }
								});
								
								
								
					
						var listEl = self.$el.find('.smart-select-0');
						var listEl1 = self.$el.find('.smart-select-1');
								
						self.smartSelect = self.$app.smartSelect.create({
							el: listEl,
						  on: {
							opened: function () {
							},
							closed: function () {
							  self.setNewState(self.smartSelect.getValue());
							}
						  }
						});	
						
								
						self.smartSelect1 = self.$app.smartSelect.create({
							el: listEl1,
						  on: {
							opened: function () {
							},
							closed: function () {
							  self.setNewCSP(self.smartSelect1.getValue());
							}
						  }
						});	
						
						
						switch(self.state){
						  case 'Productive':
								self.$setState({
									onlySuspend: true,
								});
								self.$setState({
									onlyResume: false,
								});
								self.$setState({
									onlyTerminate: true,
								});
								self.$setState({
									onlyActivate: false,
								});
								
							break;
						  case 'TestProductive':
								self.$setState({
									onlySuspend: true,
								});
								self.$setState({
									onlyResume: false,
								});
								self.$setState({
									onlyTerminate: true,
								});
								self.$setState({
									onlyActivate: true,
								});
							
							break;
						  case 'Suspended':
							 self.$setState({
									onlySuspend: false,
								});
								self.$setState({
									onlyResume: true,
								});
								self.$setState({
									onlyTerminate: true,
								});		
								self.$setState({
									onlyActivate: false,
								});								
							break;
							
						  case 'OnStock':
							 self.$setState({
									onlySuspend: false,
								});
								self.$setState({
									onlyResume: false,
								});
								self.$setState({
									onlyTerminate: false,
								});		
								self.$setState({
									onlyActivate: true,
								});								
							break;
							default:
								 self.$setState({
									onlySuspend: false,
								});
								self.$setState({
									onlyResume: false,
								});
								self.$setState({
									onlyTerminate: false,
								});									
								self.$setState({
									onlyActivate: false,
								});
						}
						
						self.smartSelect1.setValue(self.csp);
					 
				
				var thisPage = page.$el.find('.page-content'); 			

                self.initSimInfo();
				
						
				
			}
		}
    };
</script>
    