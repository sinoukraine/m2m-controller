<!--suppress JSAnnotator -->
<template>
	<div data-name="sessions" class="page sessions-page"> <!-- page-with-subnavbar -->
		<!-- Top Navbar -->
		<div class="navbar">
            <div class="navbar-bg"></div>
            <div class="navbar-inner">
                <div class="left">
                    <a href="#" class="back link icon-only " >
                        <i class="icon material-icons">arrow_back</i>
                    </a>
                </div>
                <div class="title sliding">
                    Current Session
                </div>
            </div>
        </div>
		
		<div class="page-content ">
			<div class="inner-content">
				<div key="KeyCOverview" class="col-50 tablet-20 pl-20 ">
					{{#if sessionFieldName1}}
						<div class="list no-margin" style="width:100%;">
						<ul class=" ">
						  <li>							  
							  <div class="item-inner">
								<div class="item-media  color-grey">{{sessionFieldName}}</div>
								<div class="item-title">{{sessionFieldValue}}</div>
							  </div>
						  </li>
						  <li>							  
							  <div class="item-inner">
								<div class="item-media color-grey">{{sessionFieldName4}}</div>
								<div class="item-title">{{sessionFieldValue4}}</div>
							  </div>
						  </li>
						  <li>							  
							  <div class="item-inner">
								<div class="item-media color-grey">{{sessionFieldName2}}</div>
								<div class="item-title">{{sessionFieldValue2}}</div>
							  </div>
						  </li>
						  <li>							  
							  <div class="item-inner">
								<div class="item-media color-grey">{{sessionFieldName1}}</div>
								<div class="item-title">{{sessionFieldValue1}}</div>
							  </div>
						  </li>
						  <li>							  
							  <div class="item-inner">
								<div class="item-media color-grey">{{sessionFieldName3}}</div>
								<div class="item-title">{{sessionFieldValue3}}</div>
							  </div>
						  </li>
						  <li>							  
							  <div class="item-inner">
								<div class="item-media color-grey">{{sessionFieldName5}}</div>
								<div class="item-title">{{sessionFieldValue5}}</div>
							  </div>
						  </li>
						  <li>							  
							  <div class="item-inner">
								<div class="item-media color-grey">{{sessionFieldName6}}</div>
								<div class="item-title">{{sessionFieldValue6}}</div>
							  </div>
						  </li>
						  <li>							  
							  <div class="item-inner">
								<div class="item-media color-grey">{{sessionFieldName7}}</div>
								<div class="item-title">{{sessionFieldValue7}}</div>
							  </div>
						  </li>
						</ul>
					  </div>										
					{{else}}
						<div key="KeyChartGOverviewLoader" class="absolute-center mt-20">
							<div class="preloader color-blue"></div>
						</div>
					{{/if}}  					  
				</div>
			</div>
			<!--
		
		<div key="KeyCOverview" class="col-50 tablet-20  ">
				<div class="card dashboard-card-type1 elevation-6 elevation-hover-9 elevation-transition overflow-scroll-hor  mt-5">
					
					<div class="card-header bg-color-darkgray overflow-hidden no-padding text-color-black">
						<div class="progressbar-container"></div>
						<div class="list no-hairlines no-hairlines-between" style="width:100%;" >
							<ul>
								<li class="display-flex">
									
											<div class="item-media">	
												<label for="date-to" class=" px-3">Date</label>
												<input type="text" placeholder="Date" class="pl-3"  id = "date-to" value="{{DateTo}}">
											</div>
									
								</li> 
							</ul>
						</div>     
					</div>
							{{#if DashboardDataTable.length}}
						<table id="table-sessions-sim" class="mdl-data-table " style="width:100%">
							<thead>
								<tr>
									<th> Start Time </th>	
									<th> End Time </th> 
									<th> Total Bytes </th> 		
									<th> Service </th>	
									<th> Operator </th> 		
									<th> Cell Info </th>							
								</tr>
							</thead>
							<tbody> 
								{{#DashboardDataTable}}
									<tr data-item-index="{{@index}}" >
										<td>{{start}}</td>	  
										<td>{{end}}</td>	
										<td>{{units}}</td>	
										<td>{{service}}</td>	
										<td>{{net}}</td>	
										<td>{{info}}</td>									
									</tr>
								{{/DashboardDataTable}}  
							</tbody>
						</table>{{else}}
						<div key="KeyChartGOverviewLoader" class="absolute-center">
							<div class="preloader color-blue"></div>
						</div>
						{{/if}} 
					</div>                                                                                                
			</div>
		-->
		
					
    </div>
</div>
</template>

<script>
  // script must return component object
    return { 
        data: function () {
            var self = this;
            var ret = {
				IMSIUsageArray: [],
				totalMB: [],
				DateTo: '',
				myCalendar: false,
				
				sessionFieldName: 'Start date',
				sessionFieldValue: '',
				sessionFieldName1: 'Update date',
				sessionFieldValue1: '',
				sessionFieldName2: 'End date',
				sessionFieldValue2: '',
				sessionFieldName3: 'Total bytes',
				sessionFieldValue3: '',
				sessionFieldName4: 'Operator',
				sessionFieldValue4: '',
				sessionFieldName5: 'Cell info',
				sessionFieldValue5: '',
				sessionFieldName6: 'IMEI',
				sessionFieldValue6: '',
				sessionFieldName7: 'Close status',
				sessionFieldValue7: '',
			};            
            
            if (self.$route.query.id) {
				ret.ID = self.$route.query.id;
            } 
			
			if (self.$route.query.imsi) {
				ret.IMSI = self.$route.query.imsi;
            }  			
			
			ret.DashboardDataTableEl = false; 
			ret.DashboardDataTable = [];
			//ret.DashboardDataTable = self.$app.methods.getDashboardDataTableArray();    
            ret.Charts = {
				RealTime: false,
				Overview: false,
				TotalMileage: false,
				FuelUsed: false,
			};
            return ret;
        },
		methods: {
			initSessions: async function(){
				var self = this;			
				
				const token = "00000000-0000-0000-0000-000000000000"
				/*const oneDayAgo = moment(curday, 'YYYY-MM-DD').add(-1, 'days').format('YYYY-MM-DD')
				const threeDayAgo = moment(curday, 'YYYY-MM-DD').add(-3, 'days').format('YYYY-MM-DD')
				const weekAgo = moment(curday, 'YYYY-MM-DD').add(-7, 'days').format('YYYY-MM-DD')
				*/
				const responseActiveSession = await fetch(`https://m2mdata.co/jt/GetActiveSession?imsi=${self.IMSI}`)
				let resActiveSession = await responseActiveSession.json()
				
				console.log('333',resActiveSession)
				if(resActiveSession.Data){
				
				self.$setState({
					sessionFieldValue: resActiveSession.Data.startDateField.replace("T", " ").replace("Z", "")						
				});
				self.$setState({
					sessionFieldValue1: resActiveSession.Data.lastInterimDateField.replace("T", " ").replace("Z", "")
				});
				self.$setState({
					sessionFieldValue2: resActiveSession.Data.lastInterimDateField.replace("T", " ").replace("Z", "")								
				});
				self.$setState({
					sessionFieldValue3: resActiveSession.Data.totalBytesField							
				});
				self.$setState({
					sessionFieldValue4: resActiveSession.Data.networkCodeField							
				});
				/*self.$setState({
					sessionFieldValue5: resActiveSession.Data.startDateField								
				});
				self.$setState({
					sessionFieldValue6: resActiveSession.Data.startDateField								
				});
				self.$setState({
					sessionFieldValue7: resActiveSession.Data.startDateField								
				});*/
				
				
				
				/*	self.lastUpdateTime = resActiveSession.Data.startDateField.replace("T", " ").replace("Z", "")
				
					const simActivityTime = moment(self.lastUpdateTime, 'YYYY-MM-DD').format('YYYY-MM-DD')
					console.log('comp', simActivityTime, oneDayAgo)
				  if(simActivityTime > oneDayAgo){
					self.sessionActivity = 'Productive'
					self.sessionActivityColor = 'color-status-blue'
					self.sessionActivityBg = 'bg-status-blue'
				  }else if(simActivityTime <= oneDayAgo && simActivityTime > threeDayAgo){
					self.sessionActivity = 'Active'
					self.sessionActivityColor = 'color-status-green'
					self.sessionActivityBg = 'bg-status-green'
				  }else if(simActivityTime <= threeDayAgo){             
					self.sessionActivity = 'Suspended'
					self.sessionActivityColor = 'color-status-yellow'
					self.sessionActivityBg = 'bg-status-yellow'
				  }else{ 
					self.sessionActivity = 'Productive, but no current data session'
					self.sessionActivityColor = 'color-statusr-blue'
					self.sessionActivityBg = 'bg-status-blue'
				  }
				}else{
					self.sessionActivity = 'Productive, but no current data session'
					self.sessionActivityColor = 'color-status-blue'
					self.sessionActivityBg = 'bg-status-blue'					
				}*/
			
			}else{
				self.$app.dialog.alert('No current session');
			
			}

			},
		},
        on: {
            pageInit: function (e, page) {  
				var self = this;        
				var thisPage = page.$el.find('.page-content'); 					
				
				self.initSessions();
				
				
				
			}
		}
    };
</script>
    